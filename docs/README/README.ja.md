# Multi-LLM Agents Orchestration

Codex・Gemini・GitHub Copilot といった外部ツールに複雑な作業を任せられる、Claude Code 向けのスキル集です。
やりたいことをドキュメントに書いてスキルを呼び出すだけで、計画・実装・確認の一連の作業を Claude Code が代わりに進めます。

---

## ⚠️ 必ず手動で呼び出してください

**このリポジトリのスキルは、明示的に呼び出さない限り一切動きません。**
会話の内容から意図を推測して勝手に起動したり、バックグラウンドで何かを実行したりすることはありません。

使うときは、Claude Code のプロンプトでスキル名（例: `/agent-collab`）をそのまま入力してください。

---

## 動作の流れ

`/agent-collab` を呼び出すと、Claude Code が全体の司令塔となり、次の順序で処理を進めます。

1. **Plan（計画）** — Gemini が実装計画を作成・ブラッシュアップします。
2. **Impl（実装）** — Codex または Copilot がコードを書きます。
3. **Review（確認）** — Gemini が成果物を精査します。

スクリプトを直接実行する必要はありません。Claude Code がすべて代行します。

---

## 使えるスキル一覧

| スキル                    | 役割                                                                               |
| ------------------------- | ---------------------------------------------------------------------------------- |
| `/agent-collab`           | 全体の入口です。計画・実装・確認への振り分け、または全工程の一括実行を担います。   |
| `/plan-ping-pong`         | 計画工程だけを実行します。                                                         |
| `/impl-pipeline`          | 実装工程だけを実行します。                                                         |
| `/review-pipeline`        | 確認工程だけを実行します（複数の観点による並行レビューと修正の仕組みを含みます）。 |
| `/security-lens-playbook` | セキュリティ観点でのレビューと、ゲート判定のトリアージを行います。                 |

---

## 必要な環境

**Claude Code** が動いていることが前提です。加えて、以下の CLI を少なくとも 1 つインストールし、ログインしておいてください。

| CLI                | 案内ページ                                                                                                   |
| ------------------ | ------------------------------------------------------------------------------------------------------------ |
| Gemini CLI         | [geminicli.com/docs/get-started](http://geminicli.com/docs/get-started/)                                     |
| OpenAI Codex CLI   | [developers.openai.com/codex/cli](https://developers.openai.com/codex/cli)                                   |
| GitHub Copilot CLI | [GitHub Docs](https://docs.github.com/en/copilot/how-tos/copilot-cli/set-up-copilot-cli/install-copilot-cli) |

また `python3`（`pyyaml` が必要）と `perl` を使います（macOS / Linux では最初から入っています）。

```bash
pip3 install pyyaml
```

> 実際に使う CLI だけインストールされていれば十分です。足りない CLI があれば実行中に教えてくれます。

---

## セットアップ

```bash
git clone <this-repo-url>
cd Multi-LLM-Agents-Orchestration
```

Claude Code でこのディレクトリを開くだけです。呼び出すまでは何も起きません。

---

## 使い方

### 1. 作業内容を書く

テンプレートをコピーして、やりたいことを記入します。

```bash
mkdir -p .tmp/agent-collab
cp .claude/skills/agent-collab/preflight.template.md .tmp/agent-collab/preflight.md
# .tmp/agent-collab/preflight.md を編集する
```

以下の項目を書いてください。

| 項目                      | 内容                                 |
| ------------------------- | ------------------------------------ |
| **Goal**                  | 何を達成したいか                     |
| **Scope**                 | 変えてよいもの・変えてはいけないもの |
| **Acceptance Criteria**   | 「完了」の判断基準（具体的に）       |
| **Verification Commands** | 成功を確かめるためのコマンド         |
| **Constraints**           | 互換性・性能・期日などの制約         |

書いた内容が具体的であるほど、出力の質が上がります。
面倒であれば、計画をざっくり書き出してから Claude Codeの`plan`モードを使って作成することもできます。

### 2. スキルを呼び出す

Claude Code に次のように入力します。

```text
/agent-collab
```

ファイルの内容を読んで、計画・実装・確認のどれが必要かを自動で判断し、処理を開始します。

工程を指定したい場合は、専用スキルを直接呼ぶか、指示を添えてください。

- `/plan-ping-pong` — 計画だけ実行
- `/impl-pipeline` — 実装だけ実行
- `/review-pipeline` — 確認だけ実行
- `/agent-collab` ＋「全部やって」 — 全工程を通して実行

### 3. 結果を確かめる

成果物は `.tmp/agent-collab/<run-id>/` に保存されます。処理の結果は Claude Code が要約して伝えます。何か問題があった場合は、その原因も示します。

---

## 起動後に自動でやってくれること

一度スキルを起動すれば、以下は自動で処理されます。

- **CLI の場所の検出** — NVM や Homebrew など非標準の場所にインストールされていても自動で見つけます。見つからない場合は、`which <tool>` の実行を求めることがあります。
- **使うツールの選択** — 作業の規模や種類を見て、適切なツールを自動で選びます。設定は通常不要です。
- **セキュリティチェック** — レビュー時に専用のセキュリティ確認を追加できます（設定ファイルの追加は不要）。
- **プロンプト設定の切り替え** — プロファイルを選んでいる場合、`prompts-src/profiles/` 配下の設定が自動で適用されます。
- **事前検証** — 実行前に必要なファイルが揃っているかを確認し、不足があれば即停止します。

---

## 困ったときは

**CLI が見つからないと言われる** — 不足しているツールの名前と確認手順をスキルが案内します。`which <tool>` の実行結果を貼り付けると、もう一度試みます。

**出力の質が低い** — 作業ファイルの記述が曖昧なことが多いです。「完了の判断基準」と「確認コマンド」を具体的に書き直してみてください。

**処理が止まる・タイムアウトする** — 作業量が多すぎる可能性があります。タスクを小さく分けて試してみてください。
